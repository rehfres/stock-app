(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{122:function(e,t){},125:function(e,t,n){},186:function(e,t,n){"use strict";n.r(t);var i,s,a,r=n(1),o=n.n(r),c=n(60),l=n.n(c),u=(n(91),n(5)),h=n.n(u),v=n(20),p=n(3),d=n(36),f=n(37),m=n(39),b=n(38),y=n(40),g=n(2),C=(n(95),23400);function S(e,t,n,r){!function(e,t){e.beginPath(),e.moveTo(0,s-t),e.lineTo(i,s-t),e.lineWidth=1,e.strokeStyle="#0000001a",e.stroke()}(t,r);for(var o=["positive","negative"],c=0;c<o.length;c++){var l=o[c],u={index:null,time:null};t.beginPath(),t.moveTo(0,s-r);var h=!0,v=!1,p=void 0;try{for(var d,f=n[l][Symbol.iterator]();!(h=(d=f.next()).done);h=!0){var m=d.value,b=m.index,y=m.timeInSeconds,g=m.price;t[b-u.index>1?"moveTo":"lineTo"](y*a,s-g),u.time=y,u.index=b}}catch(C){v=!0,p=C}finally{try{h||null==f.return||f.return()}finally{if(v)throw p}}t.lineWidth=1,t.strokeStyle="positive"===l?"green":"red",t.stroke(),t.lineTo(u.time*a,s-r),k(l,t,r)}}function k(e,t,n){t.save(),t.clip(),"positive"===e?(t.fillStyle="#ccebd6",t.fillRect(0,0,i,s-n)):(t.fillStyle="#ffd6d8",t.fillRect(0,s-n,i,s)),t.restore()}function M(e){"string"===typeof(e=e.toString())&&e.includes(":")||(e-=18e6,e=new Date(+e).toISOString().split("T")[1].slice(0,-1));var t=3600,n=null,i=!0,s=!1,a=void 0;try{for(var r,o=e.split(".")[0].split(":")[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){n+=r.value*t,t/=60}}catch(c){s=!0,a=c}finally{try{i||null==o.return||o.return()}finally{if(s)throw a}}return n}var O=n(41),w=n.n(O),j=n(85),x=n.n(j)()("https://ws-api.iextrading.com/1.0/last");console.log("%c\u29ed","color: #16a9c7",x),x.on("connect",function(){console.log("%c%s","color: #c76f16","connect")});var A=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(b.a)(t).call(this,e))).state={prices:[],pricesModifiedForCanvas:[],counter:0,previousClose:null,previousCloseModifiedForCanvas:null,priceMin:null,priceMax:null,coefPricesToCanvas:null,webSocketsMessagesCounter:0},n._isMounted=!1,n.canvas=o.a.createRef(),n.getDataAndMakeChart=n.getDataAndMakeChart.bind(Object(g.a)(Object(g.a)(n))),n.makeChart=n.makeChart.bind(Object(g.a)(Object(g.a)(n))),n.draw=n.draw.bind(Object(g.a)(Object(g.a)(n))),n.setPreviousClose=n.setPreviousClose.bind(Object(g.a)(Object(g.a)(n))),n.modifyEverythingForCanvas=n.modifyEverythingForCanvas.bind(Object(g.a)(Object(g.a)(n))),n.getPricesMaxMinAndCanvasCoef=n.getPricesMaxMinAndCanvasCoef.bind(Object(g.a)(Object(g.a)(n))),n}return Object(y.a)(t,e),Object(f.a)(t,[{key:"getDataAndMakeChart",value:function(){var e=Object(v.a)(h.a.mark(function e(){var t;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.iextrading.com/1.0/stock/"+this.props.symbol+"/chart/1d").then(function(e){return e.json()});case 2:return t=e.sent,e.abrupt("return",t.length?this.makeChart(t):null);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"makeChart",value:function(){var e=Object(v.a)(h.a.mark(function e(t){return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setPreviousClose(t);case 2:return this.getPricesMaxMinAndCanvasCoef(t),this.modifyEverythingForCanvas(),e.abrupt("return",this.draw());case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setPreviousClose",value:function(){var e=Object(v.a)(h.a.mark(function e(t){var n,i,s,a,r;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.iextrading.com/1.0/stock/"+this.props.symbol+"/chart/1m").then(function(e){return e.json()});case 2:n=e.sent,i=new Date(Date.now()-864e5).toISOString().split("T")[0].replace(/-/g,""),s=i===t[t.length-1].date,a=n[n.length-(s?2:1)],r=a.close,this.setState(function(e){return Object(p.a)({},e,{previousClose:r})});case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPricesMaxMinAndCanvasCoef",value:function(e){var t=[],n=[],i=!0,s=!1,a=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var c=r.value,l=c.close||c.marketClose;l&&(t.push({price:l,timeInSeconds:M(c.minute)}),n.push(l))}}catch(d){s=!0,a=d}finally{try{i||null==o.return||o.return()}finally{if(s)throw a}}var u=Math.max.apply(Math,n.concat([this.state.previousClose])),h=Math.min.apply(Math,n.concat([this.state.previousClose])),v=this.props.canvasSize.height/(u-h);this.setState(function(e){return Object(p.a)({},e,{prices:t,priceMax:u,priceMin:h,coefPricesToCanvas:v})})}},{key:"modifyEverythingForCanvas",value:function(){var e=this;this.setState(function(t){return Object(p.a)({},t,{previousCloseModifiedForCanvas:(t.previousClose-e.state.priceMin)*e.state.coefPricesToCanvas})});var t={positive:[],negative:[]},n={sign:null,time:null},i=0,s=!0,a=!1,r=void 0;try{for(var o,c=this.state.prices[Symbol.iterator]();!(s=(o=c.next()).done);s=!0){var l=o.value,u=l.price,h=this.modifyTimeForCanvas(l.timeInSeconds),v=u>=this.state.previousClose?"positive":"negative";if(n.sign!==v&&null!==n.sign)for(var d=[n.sign,v],f=0;f<d.length;f++){t[d[f]].push({timeInSeconds:(h+n.time)/2,price:this.state.previousCloseModifiedForCanvas,index:i}),i++}t[v].push({timeInSeconds:h,price:(u-this.state.priceMin)*this.state.coefPricesToCanvas,index:i}),n.sign=v,n.time=h,i++}}catch(m){a=!0,r=m}finally{try{s||null==c.return||c.return()}finally{if(a)throw r}}this.setState(function(e){return Object(p.a)({},e,{pricesModifiedForCanvas:t})})}},{key:"draw",value:function(){var e=this.canvas.current;if(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),S(0,t,this.state.pricesModifiedForCanvas,this.state.previousCloseModifiedForCanvas)}}},{key:"onSocketMessage",value:function(){var e=this;x.on("message",function(t){(t=JSON.parse(t)).symbol===e.props.symbol&&(e.mergeSocketDataToPrices(t),e.draw())})}},{key:"mergeSocketDataToPrices",value:function(e){console.log("%c\u29ed","color: #16c72e",this._isMounted),this._isMounted&&this.setState(function(e){return Object(p.a)({},e,{webSocketsMessagesCounter:e.webSocketsMessagesCounter+1})});var t=this.state.prices[this.state.prices.length-1].timeInSeconds,n=this.state.prices[this.state.prices.length-1].price,i=M(e.time),s=this.state.prices.concat([{price:e.price,timeInSeconds:i}]);this._isMounted&&this.setState(function(e){return Object(p.a)({},e,{prices:s})});var a=Math.max(this.state.priceMax,e.price),r=Math.min(this.state.priceMin,e.price),o=this.props.canvasSize.height/(a-r);this._isMounted&&this.setState(function(e){return Object(p.a)({},e,{priceMax:a,priceMin:r,coefPricesToCanvas:o})});var c=JSON.parse(JSON.stringify(this.state.pricesModifiedForCanvas)),l=e.price>=this.state.previousClose?"positive":"negative",u=n>=this.state.previousClose?"positive":"negative",h=this.state.pricesModifiedForCanvas[u][this.state.pricesModifiedForCanvas[u].length-1].index+1;if(u!==l)for(var v=[u,l],d=0;d<v.length;d++){c[v[d]].push({timeInSeconds:this.modifyTimeForCanvas((i+t)/2),price:this.state.previousCloseModifiedForCanvas,index:h}),h++}c[l].push({timeInSeconds:this.modifyTimeForCanvas(i),price:(e.price-this.state.priceMin)*this.state.coefPricesToCanvas,index:h}),this._isMounted&&this.setState(function(e){return Object(p.a)({},e,{pricesModifiedForCanvas:c})})}},{key:"modifyTimeForCanvas",value:function(e){return e-34200}},{key:"componentDidMount",value:function(){var e=this;this._isMounted=!0,w.a.DP=2,this.getDataAndMakeChart().then(function(){var t;t=e.props.symbol,x.emit("subscribe",t),console.log("%c%s","color: #c716a1",t+" subbed"),e.onSocketMessage()})}},{key:"componentWillUnmount",value:function(){var e;e=this.props.symbol,x.emit("unsubscribe",e),console.log("%c%s","color: #bd8fb3",e+" unsubbed"),this._isMounted=!1}},{key:"render",value:function(){if(!this.state.prices.length)return null;var e=this.state.prices[this.state.prices.length-1].price,t=w()(e).minus(this.state.previousClose).toString(),n=w()(e).times(100).div(this.state.previousClose).minus(100).toString();return o.a.createElement("div",{className:"chart"},o.a.createElement("div",{className:"text"},o.a.createElement("p",{className:"symbol"},this.props.symbol),o.a.createElement("p",{className:"price"},e),o.a.createElement("p",{className:"change "+(t>=0?"positive":"negative")},t," (",n,"%)")),o.a.createElement("canvas",{ref:this.canvas,width:this.props.canvasSize.width,height:this.props.canvasSize.height}))}}]),t}(r.Component),P=(n(125),n(8));P.initializeApp({apiKey:"AIzaSyDVs10hAUStxGmb_TxSEIR7iW78NyqwVKE",authDomain:"stock-app-b7556.firebaseapp.com",databaseURL:"https://stock-app-b7556.firebaseio.com",projectId:"stock-app-b7556",storageBucket:"stock-app-b7556.appspot.com",messagingSenderId:"174869200663"});var E=P.firestore();E.settings({timestampsInSnapshots:!0});var L,T=new P.auth.GoogleAuthProvider;function F(){return new Promise(function(e){P.auth().onAuthStateChanged(function(t){t?(L=t.uid,e(t)):e(P.auth().signInWithPopup(T).then(function(e){L=e.user.uid}).catch(function(e){console.log(e),alert(e.message)}))})})}var I=n(61),D=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(b.a)(t).call(this,e))).state={search:"SNAP",symbolsListActive:[],symbolsList:[],searchList:[],canvasSize:{height:35,width:100}},n.search=n.search.bind(Object(g.a)(Object(g.a)(n))),n.reorderCharts=n.reorderCharts.bind(Object(g.a)(Object(g.a)(n))),n.initCanvasSizes=n.initCanvasSizes.bind(Object(g.a)(Object(g.a)(n))),n}return Object(y.a)(t,e),Object(f.a)(t,[{key:"handleClick",value:function(){console.log(this.state.counter),this.setState(function(e){return{counter:e.counter+1}})}},{key:"getSymbolsList",value:function(){var e=this;return fetch("https://api.iextrading.com/1.0/ref-data/symbols?filter=symbol").then(function(e){return e.json()}).then(function(t){var n=t.map(function(e){return e.symbol});e.setState(function(e){return Object(p.a)({},e,{symbolsList:n,searchList:e.symbolsList})})})}},{key:"getSymbolsListActive",value:function(){var e=Object(v.a)(h.a.mark(function e(){var t;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.collection("users").doc(L).get().then(function(e){var t=e.data();return t?t.symbols:E.collection("users").doc(L).set({symbols:[]},{merge:!0}).then(function(){return[]})});case 2:t=e.sent,console.log("%c\u29ed","color: #2516c7",t),this.setState(function(e){return Object(p.a)({},e,{symbolsListActive:t})}),console.log("%c\u29ed","color: #c76f16",this.state.symbolsListActive);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"search",value:function(e){var t=(e.target?e.target.value:e).toUpperCase(),n=this.state.symbolsList.filter(function(e){return e.startsWith(t)})||[];this.setState(function(e){return Object(p.a)({},e,{searchList:n,search:t})})}},{key:"tryToAddSymbolChart",value:function(e){if(!this.state.symbolsListActive.some(function(t){return t===e}))return this.setState(function(t){return Object(p.a)({},t,{symbolsListActive:t.symbolsListActive.concat([e])})}),function(e){return E.collection("users").doc(L).update({symbols:P.firestore.FieldValue.arrayUnion(e)})}(e)}},{key:"reorderCharts",value:function(e){console.log("%c\u29ed","color: #6c16c7",e),console.log("%c\u29ed","color: #c76f16",this.state.symbolsListActive);var t=e.removedIndex,n=e.addedIndex;if(t!==n){var i,s=this.state.symbolsListActive.slice(),a=s.splice(t,1)[0];n&&s.splice(n,0,a),console.log("%c\u29ed","color: #1663c7",s),this.setState(function(e){return Object(p.a)({},e,{symbolsListActive:s})}),i=s,E.collection("users").doc(L).update({symbols:i})}}},{key:"initCanvasSizes",value:function(){var e=this;this.setState(function(e){return Object(p.a)({},e,{canvasSize:{height:35*window.devicePixelRatio,width:100*window.devicePixelRatio}})},function(){return t=e.state.canvasSize,console.log("%c\u29ed","color: #c74b16",t),i=t.width,s=t.height,void(a=i/C);var t})}},{key:"componentDidMount",value:function(){var e=this;this.initCanvasSizes(),F().then(function(){return e.getSymbolsListActive()}),this.getSymbolsList().then(function(){return e.search(e.state.search)})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"App"},o.a.createElement("p",null,window.devicePixelRatio),o.a.createElement("header",{className:"App-header"},o.a.createElement("input",{className:"search-bar",type:"text",placeholder:"Search",value:this.state.search,onChange:this.search}),o.a.createElement("ul",{className:"search-options"},this.state.searchList.map(function(t){return o.a.createElement("li",{key:t},o.a.createElement("button",{onMouseDown:function(){return e.tryToAddSymbolChart(t)}},t))}).slice(0,28))),o.a.createElement("div",{className:"charts-container"},o.a.createElement(I.Container,{onDrop:this.reorderCharts,removeOnDropOut:!0},this.state.symbolsListActive.map(function(t){return o.a.createElement(I.Draggable,{key:t},o.a.createElement(A,{symbol:t,canvasSize:e.state.canvasSize}))}))))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(o.a.createElement(D,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},86:function(e,t,n){e.exports=n(186)},91:function(e,t,n){},95:function(e,t,n){}},[[86,2,1]]]);
//# sourceMappingURL=main.7cb9c516.chunk.js.map